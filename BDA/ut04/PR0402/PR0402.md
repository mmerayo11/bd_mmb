# PR0402: Trabajando con datos del clima en MapReduce

## Ejercicio 1: temperatura máxima por ciudad

### mapper
```
import sys
import csv

reader = csv.reader(sys.stdin)

for row in reader:
    if row[7] == 'AvgTemperature':
        continue

    city = row[3]
    temperature = float(row[7])

    if temperature > -90:
        print(f"{city}\t{temperature}")
```

### reducer
```
import sys

current_city= None
max_temp= 9999

for line in sys.stdin:
    line = line.strip()
    parts = line.split('\t')

    if len(parts) != 2:
        continue
        
    city, temp_str = parts
    
    try:
        temp = float(temp_str)
    except ValueError:
        continue

    if current_city and current_city != city:
        print(f"{current_city}\t{max_temp}")
        max_temp = -9999.0 # Reiniciamos para la nueva ciudad
    
    current_city = city

    if temp > max_temp:
        max_temp = temp

if current_city:
    print(f"{current_city}\t{max_temp}")
```

### Salida

```
!cat "{csv_file}" \
| python3 mapper1.py | sort | python3 reducer1.py 
```

## Ejercicio 2: media histórica por país

### mapper
```
import sys
import csv

reader = csv.reader(sys.stdin)

for row in reader:
    if row[7] == 'AvgTemperature':
        continue

    country = row[1]
    temperature = float(row[7])

    if temperature > -90:
        print(f"{country}\t{temperature}")
```

### reducer
```
import sys

current_country= None
contador = 0
total_temp = 0

for line in sys.stdin:
    line = line.strip()
    parts = line.split('\t')

    if len(parts) != 2:
        continue
        
    country, temp_str = parts
    
    try:
        temp = float(temp_str)
    except ValueError:
        continue

    if current_country and current_country != country:
        avg_temp = total_temp/contador
        print(f"{current_country}\t{round(avg_temp, 2)}")
        contador = 0
        total_temp = 0

    current_country = country
    total_temp += temp
    contador += 1   
    

if current_country and current_count > 0:
    avg_temp = total_temp / contador
    print(f"{current_country}\t{avg_temp}")
```

### Salida

```
!cat "{csv_file}" \
| python3 mapper2.py | sort | python3 reducer2.py 
```

## Ejercicio 3: conteo de días calurosos por ciudad

### mapper
```
import sys
import csv

reader = csv.reader(sys.stdin)

for row in reader:
    if row[7] == 'AvgTemperature':
        continue

    city = row[3]
    temperature = float(row[7])
    year = row[6]

    if temperature > -90:
        print(f"{city}\t{year}\t{temperature}")
```

### reducer
```
import sys

current_key= None
contador=0

for line in sys.stdin:
    line = line.strip()
    parts = line.split('\t')

    if len(parts) < 3:
        continue
        
    city, year, temp_str = parts
    
    try:
        temp = float(temp_str)
    except ValueError:
        continue
        
    key = f"{city}\t{year}"
    
    if current_key and current_key != key:
        print(f"{current_key}\t{contador}")
        contador =0
    
    current_key = key

    if temp > 30:
        contador+=1

if current_key:
    print(f"{current_key}\t{contador}")
```

### Salida

```
!cat "{csv_file}" \
| python3 mapper3.py | sort | python3 reducer3.py 
```

## Ejercicio 4: rango de temperaturas por ciudad (Min/Max)

### mapper
```
import sys
import csv

reader = csv.reader(sys.stdin)

for row in reader:
    if row[7] == 'AvgTemperature':
        continue

    region = row[0]
    temperature = float(row[7])

    if temperature > -90:
        print(f"{region}\t{temperature}")
```

### reducer
```
import sys

current_region = None
min_temp = float('inf')  
max_temp = float('-inf')

for line in sys.stdin:
    line = line.strip()
    parts = line.split('\t')

    if len(parts) != 2:
        continue

    region, temp_str = parts

    try:
        temp = float(temp_str)
    except ValueError:
        continue

    if current_region and current_region != region:
        print(f"{current_region}\tMin: {min_temp}\tMax: {max_temp}")
        
        min_temp = float('inf')
        max_temp = float('-inf')

    current_region = region

    if temp < min_temp:
        min_temp = temp
    
    if temp > max_temp:
        max_temp = temp

if current_region:
    print(f"{current_region}\tMin: {min_temp}\tMax: {max_temp}")
```

### Salida

```
!cat "{csv_file}" \
| python3 mapper4.py | sort | python3 reducer4.py 
```